[tool.ruff]
# Python 版本目标
target-version = "py311"

# 包含的文件路径
include = ["*.py", "*.pyi", "**/pyproject.toml"]

# 排除的文件/目录
exclude = [
    ".git",
    ".venv",
    "__pycache__",
    "*.egg-info",
]

# 每行最大字符数
line-length = 100

# 缩进使用 4 个空格
indent-width = 4

[tool.ruff.lint]
# 启用的规则集
select = [
    # Pyflakes - Python 语法错误和未定义名称
    "F",
    # pycodestyle - PEP 8 风格检查
    "E",
    "W",
    # Pyupgrade - Python 升级检查
    "UP",
    # flake8-bugbear - 潜在 bug 检查
    "B",
    # flake8-simplify - 简化代码建议
    "SIM",
    # isort - 导入排序
    "I",
    # pydocstyle - 文档字符串规范
    "D",
    # flake8-annotations - 类型注解检查
    "ANN",
    # flake8-return - return 语句检查
    "RET",
    # flake8-unused-arguments - 未使用参数检查
    "ARG",
    # flake8-comprehensions - 推导式优化
    "C4",
    # flake8-boolean-trap - 布尔陷阱检查
    "FBT",
    # flake8-errmsg - 错误消息检查
    "EM",
    # flake8-implicit-str-concat - 隐式字符串连接
    "ISC",
    # flake8-logging - 日志检查
    "LOG",
    # flake8-print - print 语句检查
    "T20",
    # pep8-naming - 命名规范
    "N",
    # flake8-quotes - 引号使用
    "Q",
]

# 忽略的规则
ignore = [
    # 文档字符串相关（项目初期可以先放宽）
    "D100",  # 缺少模块文档字符串
    "D104",  # 缺少包文档字符串
    "D107",  # 缺少 __init__ 文档字符串
    "D101",  # 缺少类文档字符串
    "D102",  # 缺少方法文档字符串
    "D103",  # 缺少函数文档字符串
    "D415",  # 文档字符串第一行需要标点（中文文档不需要）
    # 类型注解相关（FastAPI 会自动推断部分类型）
    "ANN101",  # 缺少 self 类型注解
    "ANN102",  # 缺少 cls 类型注解
    "ANN201",  # 缺少返回类型注解
    "ANN401",  # 使用 Any 类型
    # FastAPI 依赖注入相关（B008 会误报 Depends）
    "B008",  # 不要在参数默认值中调用函数
    # 行长度（字符串和提示词经常很长）
    "E501",  # 行太长
    # print 语句（开发阶段暂时保留）
    "T201",  # 使用了 print
    # 未使用参数（API 设计需要保持参数一致性）
    "ARG001",  # 未使用的函数参数
    # 其他
    "D203",  # 1 个空行 before class docstring (与 D211 冲突)
    "D213",  # 多行 docstring 第二行开始 (与 D212 冲突)
]

# 允许修复的规则
fixable = ["ALL"]

# 不允许修复的规则
unfixable = []

# 每个文件允许的最大复杂度
mccabe.max-complexity = 10

[tool.ruff.lint.pydocstyle]
# 使用 Google 风格的文档字符串
convention = "google"

[tool.ruff.lint.isort]
# 已知的第一方包
known-first-party = ["app"]

[tool.ruff.format]
# 使用双引号
quote-style = "double"

# 缩进使用空格
indent-style = "space"

# 跳过魔法逗号检测（不使用尾随逗号）
skip-magic-trailing-comma = false

# 行尾换行符
line-ending = "auto"

[tool.ruff.lint.per-file-ignores]
# 测试文件的特殊规则
"**/test_*.py" = [
    "S101",  # 允许使用 assert
    "D",     # 放宽文档字符串要求
    "ANN",   # 放宽类型注解要求
]

# 数据库迁移文件
"**/migrations/**" = [
    "ALL",   # 忽略所有规则
]
